#!/bin/bash

# File containing all key IDs
KEYS_FILE="kms_keys.txt"

# Check if the keys file exists and is not empty
if [ ! -f "$KEYS_FILE" ]; then
    echo "Error: $KEYS_FILE not found. Exiting."
    exit 1
fi

if [ ! -s "$KEYS_FILE" ]; then
    echo "Error: $KEYS_FILE is empty. Exiting."
    exit 1
fi

# Process each key ID line-by-line
while IFS= read -r KEY_ID; do
    # Skip empty lines or whitespace
    if [ -z "$KEY_ID" ]; then
        continue
    fi

    echo "Fetching details for key: $KEY_ID"

    # Directly execute the describe-key command and echo the output
    aws kms describe-key --key-id "$KEY_ID" --output text || echo "Error fetching details for key: $KEY_ID"

    # Add a separator for clarity
    echo "----------------------------------------"
done < "$KEYS_FILE"
